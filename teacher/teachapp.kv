#: import Button kivy.uix.button.Button
#:import C kivy.utils.get_color_from_hex
#:import hex kivy.utils.get_color_from_hex
#:import Factory kivy.factory.Factory

<CustomBtn@Button>:
	background_color: (0, 0, 0, 0)
	background_normal: ''
	color: (0, 0, 0, 1)

	canvas.before:
		Color:
			rgba: hex('f39f18')

		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [20,]

<Label>:
	font_size: 32
	font_name: 'fonts/Alternates'

<TabelRow@GridLayout>:

	size_hint: .9, None
	height: self.minimum_height

	cols: 4

	canvas.before:
		Color:
			rgba: (1, 1, 1, 1)
		Line:
			width: 1
			rectangle: self.x, self.y, self.width, self.height


<ExcelPopup>:
	title: 'Экспорт завершён'
	anchor_title: 'center'

	size_hint: .3, .2

	CustomBtn:
		size_hint: .5, .8
		text: 'открыть файл'
		color: (0, 0, 0, 1)
		pos_hint: {'center_y': 0.5}
		on_release: root.go_xlsx()


<MyPopup>:

	id: my_popup
	title: 'Проверка'
	auto_dismiss: False
	size_hint: None, None
	size: 400, 200

	BoxLayout:

		orientation: 'vertical'
		spacing: 10
		size_hint: 1, None
		pos_hint: {'center_y':0.5}

		TextInput:

			id: password_input

			halign: 'center'
			hint_text: 'пароль'
			multiline: False
			font_size: 28
			focus: True
			password: True
			password_mask: '•'

			size_hint: None, None
			size: 150, 50
			pos_hint:{'center_x':0.5}


		CustomBtn:

			text: 'Продолжить'
			font_size: 12

			size_hint: None, None
			size: 100, 50
			pos_hint:{'center_x':0.5}

			on_release: root.check()


<ChooseTest@Popup>:

	on_open: root.tb_list(), root.test_name()

	size_hint: None, None
	size: 560, 600
	title: 'Выберите тест.'

	ScrollView:

		size: self.size
		pos_hint: {'top': 1}


		GridLayout:

			size_hint_y: None
			height: self.minimum_height

			cols: 1
			padding: 10

			BoxLayout:

				size_hint_y: None
				height: 50
				padding: 50

				AnchorLayout:
					anchor_x: 'center'
					anchor_y: 'top'

					BoxLayout:

						orientation: 'horizontal'

						size_hint: None, None
						height: 50
						width: 400

						spacing: 20


						CustomBtn:

							size_hint: None, None
							size: 50, 50
							on_press: root.edit_test(choosed_test.text)

							Image:
								source: 'img/edit.ico'
								size: list(map(lambda x: x-10, self.parent.size))
								pos: list(map(lambda x: x+5, self.parent.pos))
								x: self.parent.x
								y: self.parent.y
								keep_ratio: False


						Label:

							id: choosed_test

							size_hint_y: None
							texture_size: self.texture_size
							height: 50

							text: 'infoge'


						CustomBtn:

							size_hint: None, None
							size: 50, 50
							on_press: root.delete_test(choosed_test.text)

							Image:
								source: 'img/trash.ico'
								size: list(map(lambda x: x-10, self.parent.size))
								pos: list(map(lambda x: x+5, self.parent.pos))
								x: self.parent.x
								y: self.parent.y
								keep_ratio: False


			GridLayout:

				id: ch_tb

				size_hint_y: None
				height: self.minimum_height

				cols: 2
				spacing: 10
				padding: 30


<CreateTest@Popup>:
	
	title: 'Создать тест.'

	size_hint: None, None
	size: 1080, 300

	GridLayout:

		id: create_popup
		rows: 2

		BoxLayout:
			size_hint_y: None
			height: 100
			Label:
				text: 'Загрузить тест из xlsx.'

		BoxLayout:
			size_hint_y: None
			height: 100
			Label:
				text: 'Создать тест здесь.'

		AnchorLayout:
			anchor_y: 'center'
			anchor_x: 'center'
		
			TextInput:

				id: xlsx_writer

				size_hint: None, None
				size: 300, 50
				halign: 'center'
				font_size: 32
				multiline: False
				write_tab: False
				hint_text: 'comming soon'
				on_text_validate: root.go_xlsx(self.text)

		AnchorLayout:
			anchor_y: 'center'
			anchor_x: 'center'

			CustomBtn:
				size_hint: None, None
				size: 300, 50
				text: 'Создать'
				on_release: root.go_create()


<homepage>:

	GridLayout:

		cols: 1
		rows: 2

		BoxLayout:

			canvas.before:
				Color:
					rgba: 1, 1, 1, 1
				Line:
					width: 1
					rectangle: self.x, self.y, self.width, self.height

			size_hint: 1, .05

			Label:
				text: 'TeachApp'

		GridLayout:
			cols: 2

			GridLayout:

				canvas.before:
					Color:
						rgba: 1, 1, 1, 1
					Line:
						rectangle: self.x, self.y, self.width, self.height


				spacing: 10
				padding: 15
				cols: 1
				size_hint_x: .1
				orientation: 'rl-tb'

				CustomBtn:
					size_hint: None, None
					size: self.width, self.width
					on_release:Factory.ChooseTest().open()
					Image:
						source: 'img/choose.ico'
						x: self.parent.x+5
						y: self.parent.y+5
						width: self.parent.width-10
						height: self.parent.height-10
						keep_ratio: False

				CustomBtn:
					size_hint: None, None
					size: self.width, self.width
					on_release: Factory.CreateTest().open()
					Image:
						source: 'img/create.ico'
						x: self.parent.x+5
						y: self.parent.y+5
						width: self.parent.width-10
						height: self.parent.height-10
						keep_ratio: False

			ScrollView:

				id: std_tb

				size: self.size

				GridLayout:

					size_hint_y: None
					height: self.minimum_height
					
					cols: 1

					GridLayout:

						orientation: 'rl-tb'
						size_hint_y: None

						rows: 1
						height: 70
						padding: 10
						spacing: 10
						
						CustomBtn:
							size_hint: None, None
							size: 50, 50
							on_release: root.repeat_tb()
							Image:
								source: 'img/repeat.ico'
								x: self.parent.x
								y: self.parent.y
								width: self.parent.width
								height: self.parent.height
								keep_ratio: False

						CustomBtn:
							text: 'To excel'
							size_hint: None, None
							size: 150, 50
							color: (0, 0, 0, 1)
							on_release: root.write_xlsx(), Factory.ExcelPopup().open()

					BoxLayout:
						size_hint_y: None
						height: 50

						Label:
							text: '\nСВОДНАЯ ТАБЛИЦА'

					GridLayout:

						size_hint_y: None
						height: self.minimum_height
						padding: 30

						cols: 1

						TabelRow:

							id: table_students
							spacing: 20

							BoxLayout:
								size_hint_y: None
								height: 50
								Label: 
									id: test
									text: 'Тест'
									height: dp(30)
									size_hint_y: None
									color: hex('f39f18')

							BoxLayout:
								size_hint_y: None
								height: 50
								Label: 
									id: fio
									text: 'Имя Фамилия'
									height: dp(30)
									size_hint_y: None
									color: hex('f39f18')

							BoxLayout:
								size_hint_y: None
								height: 50
								Label: 
									id: class_
									text: 'Класс'
									height: dp(30)
									size_hint_y: None
									color: hex('f39f18')

							BoxLayout:
								size_hint_y: None
								height: 50
								Label: 
									id: grade
									text: 'Оценка'
									height: dp(30)
									size_hint_y: None
									color: hex('f39f18')

